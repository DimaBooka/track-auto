<div class="trips-holder">

  <div *ngIf="showMap; else noMap;">
    <div class="trip d-flex flex-column align-items-center justify-content-center" *ngFor="let trip of trips">

      <div class="trip-main-info d-flex align-items-center justify-content-between">

        <span class="direction">{{ trip.headerFrom }} to {{ trip.headerTo }}, {{ trip.city }}</span>
        <app-distance-done [estimation]="trip.estimatedDistance" [finished]="trip.finishedDistance"></app-distance-done>

      </div>

      <div class="trip-details d-flex align-items-stretch justify-content-start">
        <div class="direction d-flex flex-column align-items-stretch justify-content-start">
          <app-map [trip]="trip"></app-map>
          <app-stops [trip]="trip"></app-stops>
        </div>

        <div class="right-bar">
          <app-right-bar
            [truckType]="trip.truckType" [driverName]="trip.drivenName"
            [orderId]="trip.orderRealId" [driverMobile]="trip.driverMobile"
            [trackingUrl]="trip.trackingUrl"
          ></app-right-bar>
        </div>
      </div>

    </div>
  </div>

  <ng-template #noMap>
    <div class="trip-nomap d-flex flex-column align-items-center justify-content-center" *ngFor="let trip of trips">

      <div class="trip-main-info-nomap line-bottom-nomap w-100 d-flex align-items-center justify-content-between">
        <div class="date-direction d-flex align-items-center justify-content-center">
          <span class="date" *ngIf="trip.date">{{ trip.date }}</span>
          <span class="direction">{{ trip.headerFrom }} to {{ trip.headerTo }}, {{ trip.city }}</span>
        </div>
        <button class="button-flat" (click)="moveToDetails(trip.orderRealId)">More details <img class="more-arrow" src="/assets/Assets-Common/DropDown@2x.png" alt=""></button>
      </div>

      <div class="direction-nomap line-bottom-nomap w-100">
        <app-stops [trip]="trip"></app-stops>
      </div>

      <div class="hor-bar-nomap line-bottom-nomap w-100" *ngIf="!bookingMode">
        <app-right-bar
            [horizontal]="true" [truckType]="trip.truckType"
            [driverName]="trip.drivenName"
            [driverMobile]="trip.driverMobile"
            [trackingUrl]="trip.trackingUrl"
        ></app-right-bar>
      </div>

      <div class="hor-bar-book line-bottom-nomap w-100 d-flex align-items-center justify-content-start" *ngIf="bookingMode">
        <div class="truck-type-hor d-flex align-items-center justify-content-center">
          <div class="crop" style="background-color: rgb(216, 216, 216)">
            <img src="" alt="">
          </div>

          <span>{{ trip.truckType }}</span>
        </div>

        <span class="allocation">Driver will be allocated 2 hours before trip</span>
      </div>


      <div class="action-buttons-nomap line-bottom-nomap w-100 d-flex align-items-center justify-content-between" *ngIf="!bookingMode">
        <div class="d-flex align-items-center justify-content-center">
          <span class="price" [ngClass]="{'paid': trip.price < 900}"><img class="rupee" [src]="trip.price < 900 ? '/assets/Assets/Black_Indian_Rupee_symbol.png' : '/assets/Assets/Indian_Rupee_symbol.png'" alt="">{{ trip.price }}</span>
			  <button class="button-flat button-blue" *ngIf="trip.paymentStatus != 'paid'" (click)="initiatePayment(trip)">Make Payment</button>
          <button class="button-flat disabled" disabled *ngIf="trip.paymentStatus == 'paid' ">Paid</button>
        </div>

        <div class="second-group d-flex align-items-center justify-content-center">
          <button class="button-flat d-none d-sm-none d-md-flex d-lg-flex d-xl-flex" (click)="moveToInvoice(trip.orderRealId)">Print Invoice</button>
          <button class="button-flat" (click)="open(shareContent, trip)">Email Invoice</button>
          <button class="button-flat button-flat-out">Rebook</button>
        </div>
      </div>

      <div class="action-buttons-nomap booking-actions line-bottom-nomap w-100 d-flex align-items-center justify-content-end" *ngIf="bookingMode">

        <div class="second-group booking d-flex align-items-center justify-content-center">
          <button class="button-flat" (click)="cancelBooking(cancelBookingModal, trip)">Cancel Booking</button>
          <button class="button-flat button-flat-out">Edit booking</button>
        </div>

      </div>

    </div>
  </ng-template>

</div>

<ng-template #shareContent let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Share invoice</h4>
  </div>
  <div class="modal-body">
    <span class="order-id">Trip ID : {{ selectedTrip.orderRealId }}</span>
    <app-user-list (setUsersList)="setUsersList($event)"></app-user-list>
  </div>
  <div class="modal-footer">
    <button type="button" class="button-flat" (click)="d('Cross click')">Cancel</button>
    <button type="button" class="button-flat button-blue" (click)="c('Close click')">Share</button>
  </div>
</ng-template>

<ng-template #cancelBookingModal let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title question">Are you sure you want to cancel this booking?</h4>
  </div>
  <div class="modal-body d-flex flex-column align-items-start justify-content-center">
    <span class="order-id">Trip ID : {{ selectedTrip.orderRealId }}</span>
    <span class="warning-alert w-100">
      <span class="warning">
        <img src="/assets/Assets-Common/RedError@2x.png" alt="">
      </span>
      <span class="message">Warning! This cannot be undone.</span>
    </span>
  </div>
  <div class="modal-footer">
    <button type="button" class="button-flat" (click)="d('Cross click')">No</button>
    <button type="button" class="button-flat button-blue" (click)="c('Close click')">Yes</button>
  </div>
</ng-template>
